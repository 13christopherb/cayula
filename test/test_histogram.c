


#include "unity.h"
#include <stdio.h>
#include "histogram.h"


void setUp(void) {
}

void tearDown(void) {
}

void test_histogram_analysis_positive(void) {
    int window[1024] = {
            3, 33, 68, 84, 70, 69, 91, 17, 56, 30, 96, 86, 37, 65, 22, 72, 42, 95, 13, 25, 32, 12, 99, 62, 13, 2, 21,
            99, 50, 73, 16, 95, 49, 90, 79, 56, 94, 50, 69, 57, 9, 0, 95, 95, 79, 70, 7, 74, 80, 49, 93, 45, 66, 88, 98,
            14, 36, 51, 25, 13, 76, 41, 61, 39, 89, 6, 90, 89, 30, 82, 54, 72, 1, 3, 17, 68, 13, 30, 7, 52, 75, 8, 39,
            24, 75, 11, 56, 80, 99, 79, 52, 75, 41, 70, 56, 60, 28, 62, 44, 10, 83, 67, 6, 23, 62, 14, 16, 34, 6, 76,
            40, 15, 19, 94, 4, 16, 75, 15, 83, 7, 0, 10, 47, 30, 59, 21, 98, 9, 94, 37, 73, 46, 12, 47, 4, 11, 11, 43,
            63, 57, 73, 75, 72, 36, 66, 9, 56, 32, 83, 57, 91, 30, 34, 9, 80, 22, 66, 7, 95, 27, 68, 18, 20, 67, 93, 84,
            91, 6, 26, 51, 55, 16, 12, 20, 43, 35, 81, 66, 1, 88, 83, 38, 60, 68, 85, 24, 69, 8, 60, 46, 46, 46, 9, 22,
            86, 33, 9, 17, 86, 41, 59, 40, 52, 15, 25, 69, 6, 40, 5, 36, 22, 49, 91, 73, 85, 35, 11, 61, 64, 93, 4, 3,
            78, 32, 44, 32, 63, 93, 86, 72, 97, 91, 36, 21, 67, 52, 5, 71, 76, 16, 92, 67, 10, 78, 49, 64, 15, 81, 97,
            47, 12, 65, 94, 83, 66, 70, 2, 66, 63, 37, 73, 22, 99, 93, 18, 25, 99, 37, 86, 48, 47, 29, 9, 13, 16, 94,
            66, 1, 15, 80, 94, 90, 29, 68, 4, 94, 44, 91, 38, 63, 38, 82, 86, 78, 99, 85, 80, 21, 10, 3, 78, 54, 41, 76,
            70, 47, 32, 69, 44, 73, 69, 6, 80, 42, 19, 94, 2, 86, 37, 81, 66, 99, 38, 8, 9, 31, 14, 66, 54, 57, 88, 48,
            28, 28, 37, 22, 59, 0, 72, 26, 64, 75, 96, 43, 86, 82, 29, 79, 54, 63, 53, 52, 42, 17, 35, 56, 40, 30, 1,
            78, 81, 47, 69, 87, 13, 35, 4, 48, 23, 30, 44, 59, 55, 74, 79, 20, 55, 92, 39, 30, 75, 36, 47, 0, 34, 10,
            27, 12, 24, 53, 60, 21, 11, 73, 89, 72, 96, 90, 72, 49, 54, 34, 38, 98, 42, 4, 82, 37, 33, 53, 71, 84, 1,
            57, 46, 52, 20, 20, 78, 65, 16, 92, 63, 31, 52, 8, 6, 89, 10, 2, 35, 51, 20, 75, 92, 67, 69, 43, 23, 7, 31,
            31, 33, 67, 80, 28, 79, 31, 57, 61, 14, 17, 59, 48, 97, 98, 91, 53, 28, 32, 4, 79, 77, 57, 28, 32, 72, 93,
            74, 54, 59, 90, 50, 16, 61, 85, 88, 86, 32, 91, 78, 96, 90, 59, 20, 67, 80, 36, 33, 51, 97, 58, 37, 33, 16,
            19, 0, 27, 66, 35, 84, 97, 95, 84, 61, 23, 31, 70, 50, 66, 0, 88, 231, 188, 185, 158, 195, 199, 241, 153,
            192, 151, 250, 183, 169, 223, 217, 228, 242, 223, 188, 196, 244, 206, 213, 242, 231, 211, 197, 223, 154,
            249, 157, 235, 244, 158, 200, 157, 179, 214, 227, 175, 170, 155, 161, 217, 222, 199, 245, 237, 172, 202,
            243, 150, 184, 176, 221, 215, 189, 187, 178, 171, 208, 183, 207, 213, 246, 217, 155, 241, 188, 169, 244,
            168, 189, 236, 236, 239, 158, 173, 184, 153, 214, 165, 243, 178, 160, 221, 172, 246, 170, 181, 214, 219,
            190, 221, 205, 195, 197, 200, 151, 178, 184, 226, 159, 177, 247, 245, 188, 226, 181, 229, 175, 236, 172,
            204, 153, 183, 179, 230, 180, 232, 230, 216, 231, 211, 158, 202, 165, 236, 202, 217, 151, 237, 153, 194,
            169, 152, 238, 213, 214, 180, 177, 157, 174, 215, 160, 238, 195, 154, 160, 150, 179, 227, 172, 173, 183,
            167, 216, 236, 183, 212, 175, 243, 180, 180, 165, 206, 202, 247, 211, 198, 177, 179, 192, 151, 169, 195,
            166, 241, 227, 212, 216, 200, 231, 175, 242, 190, 186, 209, 203, 227, 219, 236, 194, 189, 219, 240, 186,
            237, 214, 210, 247, 228, 209, 243, 225, 249, 234, 163, 178, 153, 188, 185, 235, 171, 187, 201, 228, 159,
            218, 220, 220, 188, 241, 235, 192, 200, 198, 167, 168, 168, 247, 152, 211, 206, 233, 152, 154, 235, 212,
            166, 250, 204, 189, 170, 242, 217, 183, 171, 242, 183, 225, 246, 229, 213, 191, 233, 201, 177, 158, 214,
            229, 219, 182, 184, 214, 232, 244, 248, 182, 209, 183, 181, 227, 212, 230, 156, 230, 155, 191, 197, 244,
            231, 243, 190, 198, 201, 233, 184, 173, 177, 208, 219, 248, 241, 209, 159, 200, 189, 151, 202, 177, 170,
            152, 214, 200, 209, 224, 160, 226, 169, 203, 234, 189, 153, 196, 237, 178, 242, 172, 187, 172, 206, 225,
            218, 227, 197, 193, 248, 227, 241, 197, 223, 195, 157, 165, 163, 194, 244, 223, 242, 204, 155, 176, 219,
            159, 158, 239, 203, 164, 230, 154, 249, 213, 177, 174, 215, 244, 190, 233, 171, 233, 172, 161, 172, 155,
            193, 163, 197, 196, 213, 163, 234, 246, 158, 196, 200, 197, 220, 215, 220, 202, 172, 154, 234, 234, 204,
            200, 184, 244, 239, 199, 172, 214, 165, 203, 221, 195, 186, 198, 231, 183, 177, 162, 180, 162, 167, 184,
            235, 174, 176, 222, 187, 170, 209, 198, 188, 250, 166, 175, 212, 209, 198, 204, 180, 206, 245, 174, 199,
            186, 166, 171, 173, 237, 187, 232, 191, 226, 231, 160, 237, 235, 219, 206, 228, 151, 192, 213, 192, 157,
            242, 171, 239, 215, 151, 195, 219, 154, 248, 164, 175, 221, 211, 232, 213, 201, 167, 193, 236, 170, 204,
            157, 198, 244, 182, 158, 209, 152, 239, 182, 175, 204, 222, 234, 210, 179, 232, 240, 152, 237, 244, 232,
            187, 226, 218, 180, 182, 247, 151, 225, 191, 222, 191, 242, 213, 225, 223, 183, 197, 169, 238, 157, 239};
    int threshold = histogram_analysis(window);
    TEST_ASSERT_EQUAL_INT(100, threshold);
}

void test_histogram_analysis_too_small(void) {
    int window[1024] = {
            0, 6, 4, 12, 7, 12, 12, 3, 2, 0, 0, 12, 3, 11, 9, 5, 12, 3, 8, 2, 12, 15, 1, 7, 201, 200, 200, 203, 244,
            239, 213, 221, 209, 219, 247, 248, 220, 230, 228, 206, 242, 229, 237, 242, 234, 245, 241, 218, 222, 240,
            206, 207, 230, 200, 235, 205, 242, 210, 237, 201, 200, 244, 209, 227, 222, 221, 203, 216, 211, 214, 233,
            236, 212, 245, 238, 249, 217, 221, 239, 225, 224, 212, 227, 202, 213, 207, 204, 240, 240, 207, 202, 243,
            240, 235, 231, 250, 211, 248, 214, 250, 230, 203, 201, 243, 236, 214, 248, 213, 238, 218, 225, 227, 230,
            229, 229, 235, 204, 206, 217, 250, 211, 230, 212, 240, 243, 218, 238, 201, 204, 201, 249, 210, 220, 238,
            221, 201, 206, 223, 248, 225, 220, 215, 215, 220, 225, 201, 247, 240, 216, 219, 244, 213, 239, 211, 234,
            238, 230, 248, 217, 224, 201, 232, 232, 232, 238, 211, 244, 214, 218, 211, 215, 206, 217, 213, 232, 225,
            219, 228, 235, 235, 239, 221, 238, 228, 242, 200, 232, 218, 227, 203, 215, 250, 221, 208, 203, 215, 215,
            223, 200, 238, 246, 218, 231, 204, 216, 250, 201, 215, 231, 218, 212, 235, 225, 240, 246, 238, 241, 216,
            211, 218, 222, 203, 237, 204, 214, 209, 202, 206, 241, 213, 213, 230, 218, 214, 234, 231, 230, 211, 229,
            204, 219, 202, 217, 237, 240, 214, 250, 240, 244, 234, 246, 225, 234, 227, 225, 235, 227, 249, 221, 228,
            249, 218, 227, 207, 225, 227, 231, 200, 229, 246, 210, 223, 208, 205, 241, 240, 227, 247, 207, 227, 217,
            227, 203, 209, 208, 217, 208, 211, 218, 249, 214, 201, 245, 245, 238, 226, 250, 207, 233, 205, 241, 225,
            203, 222, 243, 235, 215, 202, 235, 222, 204, 205, 237, 206, 210, 212, 248, 249, 212, 231, 229, 229, 219,
            223, 224, 215, 247, 249, 204, 207, 246, 240, 223, 243, 233, 233, 229, 214, 226, 244, 214, 202, 249, 225,
            221, 213, 231, 250, 241, 248, 224, 242, 233, 241, 238, 223, 216, 209, 248, 235, 249, 227, 205, 249, 228,
            250, 204, 246, 221, 228, 227, 206, 226, 211, 219, 236, 212, 247, 240, 238, 230, 241, 242, 206, 222, 240,
            210, 224, 245, 229, 232, 244, 247, 206, 243, 240, 226, 245, 239, 227, 217, 213, 204, 219, 236, 242, 228,
            211, 216, 202, 228, 230, 237, 244, 221, 200, 245, 250, 215, 221, 226, 211, 208, 231, 218, 233, 244, 210,
            224, 244, 224, 244, 231, 205, 240, 249, 207, 231, 243, 209, 245, 210, 201, 203, 219, 200, 240, 204, 231,
            219, 222, 247, 220, 249, 222, 238, 210, 214, 232, 211, 212, 235, 229, 231, 211, 206, 245, 216, 242, 237,
            227, 242, 214, 214, 222, 238, 216, 219, 206, 204, 243, 223, 211, 228, 212, 201, 226, 228, 207, 208, 223,
            224, 236, 238, 248, 222, 217, 250, 220, 240, 229, 245, 203, 236, 203, 221, 223, 206, 228, 247, 208, 232,
            216, 238, 212, 215, 225, 227, 237, 235, 217, 214, 219, 228, 200, 237, 235, 227, 237, 206, 244, 232, 202,
            230, 214, 236, 224, 239, 234, 229, 233, 202, 247, 222, 208, 239, 203, 226, 207, 207, 232, 201, 229, 211,
            201, 238, 208, 235, 242, 235, 211, 247, 229, 210, 222, 232, 241, 214, 241, 209, 247, 212, 230, 228, 249,
            242, 225, 244, 239, 200, 233, 224, 232, 245, 240, 209, 215, 246, 220, 233, 246, 214, 230, 246, 233, 236,
            210, 248, 217, 226, 234, 224, 223, 232, 210, 203, 204, 227, 209, 220, 226, 244, 216, 235, 222, 201, 211,
            219, 240, 246, 218, 210, 222, 239, 235, 206, 208, 229, 229, 215, 223, 207, 238, 235, 236, 227, 205, 226,
            244, 202, 234, 243, 216, 240, 229, 250, 208, 202, 211, 245, 223, 235, 206, 241, 213, 222, 219, 234, 229,
            200, 213, 227, 248, 241, 242, 234, 207, 224, 203, 210, 234, 246, 227, 222, 223, 216, 201, 242, 250, 213,
            206, 203, 248, 244, 211, 202, 246, 243, 224, 227, 233, 204, 242, 210, 204, 227, 200, 211, 221, 201, 237,
            207, 249, 236, 205, 201, 204, 203, 220, 234, 217, 218, 238, 214, 239, 227, 225, 210, 205, 214, 207, 244,
            231, 242, 227, 218, 242, 226, 245, 238, 249, 225, 245, 215, 250, 243, 218, 234, 208, 242, 214, 215, 237,
            202, 231, 242, 246, 219, 208, 207, 239, 205, 220, 207, 233, 235, 227, 239, 246, 226, 230, 217, 202, 238,
            249, 221, 238, 226, 239, 208, 238, 228, 230, 212, 208, 205, 244, 241, 241, 247, 226, 217, 228, 228, 213,
            210, 200, 219, 202, 205, 237, 209, 249, 239, 229, 236, 205, 209, 241, 218, 215, 224, 206, 209, 230, 216,
            235, 223, 219, 224, 238, 247, 216, 201, 224, 224, 244, 205, 245, 222, 208, 206, 246, 235, 218, 201, 223,
            225, 207, 238, 240, 238, 217, 208, 206, 232, 237, 211, 235, 202, 222, 214, 207, 202, 221, 229, 249, 224,
            226, 226, 225, 242, 242, 221, 206, 212, 203, 220, 227, 214, 230, 243, 206, 217, 221, 201, 201, 200, 230,
            250, 232, 211, 222, 220, 248, 249, 213, 215, 230, 243, 207, 247, 222, 218, 215, 200, 226, 243, 235, 243,
            215, 212, 205, 240, 240, 241, 235, 207, 210, 219, 248, 208, 233, 245, 213, 201, 204, 246, 222, 245, 226,
            231, 232, 205, 238, 218, 214, 243, 234, 204, 209, 216, 209, 215, 232, 214, 239, 209, 238, 220, 204, 228,
            244, 242, 245, 249, 221, 234, 215, 223, 206, 200, 221, 221, 235, 209, 240, 200, 206, 245, 248, 225, 235,
            219, 208, 211, 223, 225, 201, 244, 202, 221, 244, 250, 226, 227, 205, 231, 235, 227, 232, 216, 208, 225,
            227, 225, 249, 223, 224, 209, 202, 235, 222, 203, 240, 227, 248, 227, 205, 243, 223, 245, 229, 238, 212,
            232, 246, 242, 206, 209, 222, 217, 222, 206, 235, 231, 205, 217, 207, 250, 229, 227, 232, 207, 249, 250,
            241, 238, 245, 207, 222, 229, 228, 250
    };
    int threshold = histogram_analysis(window);
    TEST_ASSERT_EQUAL_INT(-1, threshold);
}
