


#include "unity.h"
#include <stdio.h>
#include "histogram.h"


void setUp(void) {
}

void tearDown(void) {
}

void test_histogram_analysis_positive(void) {
    int window[1024] = {
            95, 106,  26,  80,  41,  65,  62,  79,  43,  62,  86,  63,  89,
            154, 109,  88,  90,  63,  94,  59,  72,  30,  70,  61, 105,  53,
            89,  62,  55,  48,   7,  66,  86, 104, 105,  70, 112,  82,  85,
            34,  78,  73,  98, 106, 137, 105,  92,  70,  82, 126, 109,  83,
            77,  91, 116, 138, 116,  54, 106, 146,  83,  66,  75,  88,  65,
            79, 101, 110,  90,  64,  98,  92,  87,  68, 105, 106,  93,   5,
            90,  51, 110,  71, 100,  74,  49,  70,  49, 153, 119,  72,  55,
            48,  60, 145,  43,  71,   8, 107,  28,  39, 127,  76,  27,  41,
            87,  44,  25,  62,  31,  86,  81,  84,  74,  61, 122, 125,  77,
            27, 110,  83, 122,  41,  35,  37, 127,  65,  85,  29, 102,  70,
            34,   5,  73,  22,  47, 114,  33, 115,  77, 101,  48,  42,  61,
            81,  86, 103, 104,  76,  61,  61,  93,  62,   0,  47,  51,  10,
            88,  84,  38,  40,  94,  37,  73, 113,  51,  99,  48,  77,  67,
            101,  99, 125,  21,  44,  49,  49,  50,  91, 101, 108, 124, 111,
            109,  74, 103,  87,  41, 127,  73,  77,  99,  72,  79,  52,  43,
            134,  98,  36,  80,  88,  75,  51,  99,  89,  37,  16,  35, 112,
            69,  69,  92,  52,  30,  57,  31,  92,  96,  64, 119,  74,  43,
            95,  79,  59,  49,  46,  89,  59, 105, 110,  51,  45,  89,  78,
            92,  71,  55,  10,  31,  76,  78,  34, 102,  61, 109,  67, 126,
            77,  69,  16, 110,  97, 108,  91,  64,  86, 148,  84,  16,  56,
            115,  77,  44,  42,  14, 131,  50, 117,  83,  55,  88,  34,  47,
            52, 103,  48, 115,  68, 116,  95,  39, 102,  77, 110,  68,  94,
            95,  84,  36,  63, 103,  60,  60,  60, 124,  54,  38,  56,  88,
            65,  83,  52,  78, 119, 123, 116, 117, 100, 132,  40,  80, 116,
            108, 101,  99,  46,  54,  66, 103,  53,  62, 113,  82,  30,  51,
            88,  58,  46,  57,  60,  79,  63,  47,  47,  34,  79, 100,  92,
            70,  89, 105,  71,  68,  84, 144,  45,  81, 101,  67,  56,  36,
            67,  31,  69,  69,  21,  95, 159,  94,  27,  84,  66,  10,  25,
            58, 143,  39,  83,  71,  75, 101,  33, 128,  49, 140,  62, 113,
            49,  76,  83,  51,  54,  45,  63,  41,  49,  78,  87,  33,  37,
            125,  50,  79,  40,  53,  24,  92,  64,  97,  54,  94,  60,  67,
            43,  62,  60,  69,  94,  61,  99,  40,  72,  73, 124,  46,  89,
            81,  47,  71,  76,  92,  58,  15,  82,   2,  45,  21,  97,  39,
            31,  70,  68,  75,  97,  38,  74,  55,  40,  83, 106,  92,  53,
            77,  96,  49,  53,  82, 119,  43,  98,  76,  96,  63,  33,  85,
            69,  85, 134,   5,  78,  85,  91,  46,  96,  65,  89,  99,  89,
            58,  25,  53,  90,  58,  49,  48,  90, 169,  62, 104,  75,  99,
            81, 131,  62,  25,  47,   2, 127, 129, 101,  98,  93,  39, 118,
            47,  53,  72,  77,  77, 114,  55,  11,  79,  88,  53,  90,  89,
            119, 110,  60, 102, 137,184, 153, 171, 194, 207, 160, 148, 162, 178, 222, 159, 178, 256,
            189, 153, 202, 175, 203, 200, 123, 200, 244, 203, 162, 162, 174,
            202, 195, 246, 159, 157, 152, 131, 161, 170, 187, 167, 133, 208,
            220, 222, 145, 150, 174, 172, 184, 152, 246, 174, 137, 200,  94,
            146, 167, 226, 148, 186, 168, 177, 194, 165, 142, 163, 139, 142,
            142, 154, 207, 162, 181, 204, 184, 148, 109, 246, 166, 138, 185,
            161, 112, 147, 173, 159, 141, 191, 230, 127, 108, 108, 176, 152,
            230, 205, 170, 158, 117, 160, 195, 207, 167, 218, 180, 202, 150,
            178, 139, 169, 166, 220, 165, 165, 171, 172, 174, 173, 196, 181,
            164, 138, 142, 177, 184, 169, 171, 199, 192, 187, 167, 112, 200,
            160, 183, 150, 144, 144, 167, 169, 134, 159, 166, 212, 165, 199,
            143, 182, 217, 128, 194, 202, 131, 193, 188, 233, 198, 215, 184,
            189, 141, 211,  82, 175, 171, 219, 137, 172, 148, 164, 166, 204,
            237, 130, 202, 234, 209, 188, 169, 159, 196, 178, 162, 163, 204,
            166, 161, 203, 170, 190, 203, 219, 189, 196, 147, 180, 168, 125,
            215, 156, 150, 160, 172, 166, 197, 191, 194, 169, 137, 115, 149,
            181, 133, 114, 240, 133, 151, 180, 170, 177, 167, 212, 102, 183,
            186, 200, 154, 191, 166, 147, 187, 196, 174,  74, 194, 174, 157,
            245, 158, 210, 221, 184, 167, 167, 190, 174, 160, 208, 163, 168,
            136, 161, 169, 120, 211, 153, 204, 196, 198, 102, 156, 167, 197,
            175, 245, 185, 175, 185, 111, 199, 149, 134, 249, 154, 111, 117,
            198, 164, 215, 162, 157, 184, 155, 203, 233, 187, 158, 162, 190,
            217, 148, 131, 117, 147, 214, 173, 164, 163, 200, 168, 232, 212,
            102, 161, 194, 161, 180, 224, 142, 157, 199, 237, 176, 205, 180,
            154, 202, 226, 116, 155, 207, 195, 141, 149, 191, 181, 188, 192,
            191, 188, 172, 202, 221, 204, 149, 154, 183, 141, 196, 174, 209,
            181, 153, 155, 214, 201, 175, 105, 154, 161, 221, 212, 167, 197,
            179, 148, 154, 132, 170, 207, 171, 186, 187, 191, 161, 229, 143,
            158, 143, 160, 151, 197, 145, 167, 130, 218, 201, 196, 210, 217,
            204, 216, 193, 185, 208, 234, 183, 175, 137, 148, 184, 185, 221,
            128, 138, 168, 141, 205, 190, 217, 158, 145, 162, 135, 152, 207,
            123, 207, 200, 192, 131, 145, 174, 129, 195, 182, 202, 152, 173,
            167, 140, 211, 201, 176, 180, 164, 194, 193, 161, 170, 163, 189,
            180, 175, 171, 188, 156, 167, 174, 151, 189, 185, 232, 179, 149,
            150, 153, 201, 170, 175, 219, 164, 200, 135, 214, 199, 157, 153,
            202, 173, 175, 171, 192, 170, 181, 184, 159, 185, 153, 187, 147,
            144, 215, 189, 178, 182, 177, 181, 218, 166, 205, 141, 114, 101,
            141, 217, 173, 143, 138, 193, 168, 259, 201, 161, 131, 166, 187,
            160, 171, 108, 134, 194, 171, 223, 200, 178, 203, 163, 158, 149,
            182, 147, 218, 171, 191};
    int threshold = histogram_analysis(window);
    TEST_ASSERT_EQUAL_INT(124, threshold);
}

void test_histogram_analysis_too_small(void) {
    int window[1024] = {
            0, 6, 4, 12, 7, 12, 12, 3, 2, 0, 0, 12, 3, 11, 9, 5, 12, 3, 8, 2, 12, 15, 1, 7, 201, 200, 200, 203, 244,
            239, 213, 221, 209, 219, 247, 248, 220, 230, 228, 206, 242, 229, 237, 242, 234, 245, 241, 218, 222, 240,
            206, 207, 230, 200, 235, 205, 242, 210, 237, 201, 200, 244, 209, 227, 222, 221, 203, 216, 211, 214, 233,
            236, 212, 245, 238, 249, 217, 221, 239, 225, 224, 212, 227, 202, 213, 207, 204, 240, 240, 207, 202, 243,
            240, 235, 231, 250, 211, 248, 214, 250, 230, 203, 201, 243, 236, 214, 248, 213, 238, 218, 225, 227, 230,
            229, 229, 235, 204, 206, 217, 250, 211, 230, 212, 240, 243, 218, 238, 201, 204, 201, 249, 210, 220, 238,
            221, 201, 206, 223, 248, 225, 220, 215, 215, 220, 225, 201, 247, 240, 216, 219, 244, 213, 239, 211, 234,
            238, 230, 248, 217, 224, 201, 232, 232, 232, 238, 211, 244, 214, 218, 211, 215, 206, 217, 213, 232, 225,
            219, 228, 235, 235, 239, 221, 238, 228, 242, 200, 232, 218, 227, 203, 215, 250, 221, 208, 203, 215, 215,
            223, 200, 238, 246, 218, 231, 204, 216, 250, 201, 215, 231, 218, 212, 235, 225, 240, 246, 238, 241, 216,
            211, 218, 222, 203, 237, 204, 214, 209, 202, 206, 241, 213, 213, 230, 218, 214, 234, 231, 230, 211, 229,
            204, 219, 202, 217, 237, 240, 214, 250, 240, 244, 234, 246, 225, 234, 227, 225, 235, 227, 249, 221, 228,
            249, 218, 227, 207, 225, 227, 231, 200, 229, 246, 210, 223, 208, 205, 241, 240, 227, 247, 207, 227, 217,
            227, 203, 209, 208, 217, 208, 211, 218, 249, 214, 201, 245, 245, 238, 226, 250, 207, 233, 205, 241, 225,
            203, 222, 243, 235, 215, 202, 235, 222, 204, 205, 237, 206, 210, 212, 248, 249, 212, 231, 229, 229, 219,
            223, 224, 215, 247, 249, 204, 207, 246, 240, 223, 243, 233, 233, 229, 214, 226, 244, 214, 202, 249, 225,
            221, 213, 231, 250, 241, 248, 224, 242, 233, 241, 238, 223, 216, 209, 248, 235, 249, 227, 205, 249, 228,
            250, 204, 246, 221, 228, 227, 206, 226, 211, 219, 236, 212, 247, 240, 238, 230, 241, 242, 206, 222, 240,
            210, 224, 245, 229, 232, 244, 247, 206, 243, 240, 226, 245, 239, 227, 217, 213, 204, 219, 236, 242, 228,
            211, 216, 202, 228, 230, 237, 244, 221, 200, 245, 250, 215, 221, 226, 211, 208, 231, 218, 233, 244, 210,
            224, 244, 224, 244, 231, 205, 240, 249, 207, 231, 243, 209, 245, 210, 201, 203, 219, 200, 240, 204, 231,
            219, 222, 247, 220, 249, 222, 238, 210, 214, 232, 211, 212, 235, 229, 231, 211, 206, 245, 216, 242, 237,
            227, 242, 214, 214, 222, 238, 216, 219, 206, 204, 243, 223, 211, 228, 212, 201, 226, 228, 207, 208, 223,
            224, 236, 238, 248, 222, 217, 250, 220, 240, 229, 245, 203, 236, 203, 221, 223, 206, 228, 247, 208, 232,
            216, 238, 212, 215, 225, 227, 237, 235, 217, 214, 219, 228, 200, 237, 235, 227, 237, 206, 244, 232, 202,
            230, 214, 236, 224, 239, 234, 229, 233, 202, 247, 222, 208, 239, 203, 226, 207, 207, 232, 201, 229, 211,
            201, 238, 208, 235, 242, 235, 211, 247, 229, 210, 222, 232, 241, 214, 241, 209, 247, 212, 230, 228, 249,
            242, 225, 244, 239, 200, 233, 224, 232, 245, 240, 209, 215, 246, 220, 233, 246, 214, 230, 246, 233, 236,
            210, 248, 217, 226, 234, 224, 223, 232, 210, 203, 204, 227, 209, 220, 226, 244, 216, 235, 222, 201, 211,
            219, 240, 246, 218, 210, 222, 239, 235, 206, 208, 229, 229, 215, 223, 207, 238, 235, 236, 227, 205, 226,
            244, 202, 234, 243, 216, 240, 229, 250, 208, 202, 211, 245, 223, 235, 206, 241, 213, 222, 219, 234, 229,
            200, 213, 227, 248, 241, 242, 234, 207, 224, 203, 210, 234, 246, 227, 222, 223, 216, 201, 242, 250, 213,
            206, 203, 248, 244, 211, 202, 246, 243, 224, 227, 233, 204, 242, 210, 204, 227, 200, 211, 221, 201, 237,
            207, 249, 236, 205, 201, 204, 203, 220, 234, 217, 218, 238, 214, 239, 227, 225, 210, 205, 214, 207, 244,
            231, 242, 227, 218, 242, 226, 245, 238, 249, 225, 245, 215, 250, 243, 218, 234, 208, 242, 214, 215, 237,
            202, 231, 242, 246, 219, 208, 207, 239, 205, 220, 207, 233, 235, 227, 239, 246, 226, 230, 217, 202, 238,
            249, 221, 238, 226, 239, 208, 238, 228, 230, 212, 208, 205, 244, 241, 241, 247, 226, 217, 228, 228, 213,
            210, 200, 219, 202, 205, 237, 209, 249, 239, 229, 236, 205, 209, 241, 218, 215, 224, 206, 209, 230, 216,
            235, 223, 219, 224, 238, 247, 216, 201, 224, 224, 244, 205, 245, 222, 208, 206, 246, 235, 218, 201, 223,
            225, 207, 238, 240, 238, 217, 208, 206, 232, 237, 211, 235, 202, 222, 214, 207, 202, 221, 229, 249, 224,
            226, 226, 225, 242, 242, 221, 206, 212, 203, 220, 227, 214, 230, 243, 206, 217, 221, 201, 201, 200, 230,
            250, 232, 211, 222, 220, 248, 249, 213, 215, 230, 243, 207, 247, 222, 218, 215, 200, 226, 243, 235, 243,
            215, 212, 205, 240, 240, 241, 235, 207, 210, 219, 248, 208, 233, 245, 213, 201, 204, 246, 222, 245, 226,
            231, 232, 205, 238, 218, 214, 243, 234, 204, 209, 216, 209, 215, 232, 214, 239, 209, 238, 220, 204, 228,
            244, 242, 245, 249, 221, 234, 215, 223, 206, 200, 221, 221, 235, 209, 240, 200, 206, 245, 248, 225, 235,
            219, 208, 211, 223, 225, 201, 244, 202, 221, 244, 250, 226, 227, 205, 231, 235, 227, 232, 216, 208, 225,
            227, 225, 249, 223, 224, 209, 202, 235, 222, 203, 240, 227, 248, 227, 205, 243, 223, 245, 229, 238, 212,
            232, 246, 242, 206, 209, 222, 217, 222, 206, 235, 231, 205, 217, 207, 250, 229, 227, 232, 207, 249, 250,
            241, 238, 245, 207, 222, 229, 228, 250
    };
    int threshold = histogram_analysis(window);
    TEST_ASSERT_EQUAL_INT(-1, threshold);
}
